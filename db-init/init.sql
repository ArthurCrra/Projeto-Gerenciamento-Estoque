-- =================================================================
-- PARTE 1: CRIACAO DAS TABELAS (NA ORDEM CORRETA)
-- =================================================================

-- Nível 1: Tabelas sem dependências
CREATE TABLE usuario (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome VARCHAR(255),
    email VARCHAR(255),
    senha VARCHAR(255),
    funcao VARCHAR(255)
);

CREATE TABLE fornecedor (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome VARCHAR(255),
    email VARCHAR(255),
    telefone VARCHAR(255),
    cnpj VARCHAR(255)
);

CREATE TABLE armazenamento (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    sala VARCHAR(255),
    armario VARCHAR(255)
);

-- Nível 2: Depende de 'usuario'
CREATE TABLE projeto (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    apelido_projeto VARCHAR(255),
    usuario BIGINT,
    FOREIGN KEY (usuario) REFERENCES usuario(id)
);

-- Nível 3: Depende de 'projeto' e 'fornecedor'
CREATE TABLE compra (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    data_compra TIMESTAMP,
    observacao VARCHAR(255),
    projeto_id BIGINT NOT NULL,
    fornecedor_id BIGINT,
    FOREIGN KEY (projeto_id) REFERENCES projeto(id),
    FOREIGN KEY (fornecedor_id) REFERENCES fornecedor(id)
);

-- Nível 4: Dependem de tabelas já criadas
CREATE TABLE item (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome VARCHAR(255),
    valor_unitario DOUBLE PRECISION,
    quantidade INTEGER,
    valor_total DOUBLE PRECISION,
    armazenamento_id BIGINT NOT NULL,
    compra_id BIGINT NOT NULL,
    FOREIGN KEY (armazenamento_id) REFERENCES armazenamento(id),
    FOREIGN KEY (compra_id) REFERENCES compra(id)
);

CREATE TABLE invoice (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    data_emissao TIMESTAMP,
    compra BIGINT NOT NULL,
    FOREIGN KEY (compra) REFERENCES compra(id)
);

-- =================================================================
-- PARTE 2: INSERCAO DOS DADOS INICIAIS
-- =================================================================

--Usuario
INSERT INTO Usuario (id, email, nome, senha, funcao) VALUES (1, 'joao@example.com', 'João Silva', '123456', 'Gerente');
INSERT INTO Usuario (id, email, nome, senha, funcao) VALUES (2, 'maria@example.com', 'Maria Souza', 'abcdef', 'Técnico');


--fornecedor
INSERT INTO Fornecedor (id, cnpj, email, nome, telefone) 
VALUES (1, 'Fornecedor A', 'contato@fornecedorA.com', '(48) 99999-1111', '12.345.678/0001-90');

INSERT INTO Fornecedor (id, cnpj, email, nome, telefone) 
VALUES (2, 'Fornecedor B', 'contato@fornecedorB.com', '(11) 98888-2222', '98.765.432/0001-09');


-- Armazenamento
INSERT INTO Armazenamento (id, armario, sala) VALUES (1, 'Sala 101', 'A1');
INSERT INTO Armazenamento (id, armario, sala) VALUES (2, 'Sala 202', 'B3');


-- Projeto
INSERT INTO Projeto (id, apelido_projeto, usuario) VALUES (1, 'Projeto Alpha', 1);
INSERT INTO Projeto (id, apelido_projeto, usuario) VALUES (2, 'Projeto Beta', 2);


-- Compra
INSERT INTO Compra (id, projeto_id, data_compra, observacao, fornecedor_id) 
VALUES (1, 1, '2025-06-01 10:30:00', 'Compra de componentes elétricos', 1);

INSERT INTO Compra (id, projeto_id, data_compra, observacao, fornecedor_id) 
VALUES (2, 2, '2025-06-05 15:45:00', 'Compra de ferramentas', 2);


-- Item
INSERT INTO Item (id, nome, quantidade, valor_total, valor_unitario, armazenamento_id, compra_id) 
VALUES (1, 'Resistor 220 Ohm', 0.15, 100, 15.00, 1, 1);

INSERT INTO Item (id, nome, quantidade, valor_total, valor_unitario, armazenamento_id, compra_id) 
VALUES (2, 'Chave de Fenda', 10.00, 3, 30.00, 2, 2);


-- Invoice
INSERT INTO Invoice (id, data_emissao, compra) 
VALUES (1, '2025-06-02 08:00:00', 1);

INSERT INTO Invoice (id, data_emissao, compra) 
VALUES (2, '2025-06-06 09:30:00', 2);